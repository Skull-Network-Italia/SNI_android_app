name: Code Analysis

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  analyze:
    runs-on: self-hosted

    steps:
      - uses: actions/checkout@v4
        with:
          clean: false

      # ---- C / C++ ----
      - name: Analyze C/C++
        run: |
          if (Test-Path "*.c" -or Test-Path "*.cpp") {
            clang-tidy *.c *.cpp --quiet
          } else {
            echo "No C/C++ files found"
          }

      # ---- CMake ----
      - name: Analyze CMake
        run: |
          if (Test-Path "CMakeLists.txt") {
            cmake-lint CMakeLists.txt
          } else {
            echo "No CMake files"
          }

      # ---- Dart ----
      - name: Analyze Dart
        run: |
          if (Test-Path "*.dart") {
            dart analyze
          } else {
            echo "No Dart files"
          }

      # ---- HTML ----
      - name: Analyze HTML
        run: |
          if (Test-Path "*.html") {
            htmlhint "**/*.html"
          } else {
            echo "No HTML files"
          }

      # ---- Swift (best effort) ----
      - name: Analyze Swift
        continue-on-error: true
        run: |
          if (Test-Path "*.swift") {
            swiftlint
          } else {
            echo "No Swift files"
          }
